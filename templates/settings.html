
{% extends "base.html" %}

{% block title %}Settings - WhatsApp Bot Creator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <a href="{{ url_for('bots.dashboard') }}" class="btn btn-sm btn-outline-secondary mb-3">&larr; Back to Dashboard</a>
        <h2>‚öôÔ∏è Settings</h2>
        <p class="text-muted">Configure your web app preferences and API settings</p>
        <hr>
    </div>
</div>

<div class="row">
    <!-- Appearance Settings -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üé® Appearance</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="form_type" value="appearance">
                    <div class="mb-3">
                        <label for="theme" class="form-label">Color Theme</label>
                        <select class="form-select" id="theme" name="theme">
                            <option value="light" {% if current_theme == 'light' %}selected{% endif %}>Light</option>
                            <option value="dark" {% if current_theme == 'dark' %}selected{% endif %}>Dark</option>
                            <option value="auto" {% if current_theme == 'auto' %}selected{% endif %}>Auto (System)</option>
                        </select>
                        <small class="text-muted">Choose your preferred color scheme</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Appearance</button>
                </form>
            </div>
        </div>
    </div>

    <!-- API Configuration -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üîå API Configuration</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="form_type" value="api">
                    <div class="mb-3">
                        <label for="whatsapp_provider" class="form-label">WhatsApp Provider</label>
                        <select class="form-select" id="whatsapp_provider" name="whatsapp_provider">
                            <option value="meta" {% if current_provider == 'meta' %}selected{% endif %}>Meta Cloud API (Free)</option>
                            <option value="twilio" {% if current_provider == 'twilio' %}selected{% endif %}>Twilio</option>
                        </select>
                        <small class="text-muted">Select your WhatsApp messaging provider</small>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <strong>API Status:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Meta API: 
                                {% if env_status.meta_configured %}
                                    <span class="badge bg-success">Configured ‚úì</span>
                                {% else %}
                                    <span class="badge bg-warning">Not Configured</span>
                                {% endif %}
                            </li>
                            <li>Twilio API: 
                                {% if env_status.twilio_configured %}
                                    <span class="badge bg-success">Configured ‚úì</span>
                                {% else %}
                                    <span class="badge bg-warning">Not Configured</span>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Save API Settings</button>
                </form>
                
                <hr>
                <div class="mt-3">
                    <h6>Configure API Keys:</h6>
                    <p class="small text-muted">API keys must be set in Replit Secrets (üîí icon in sidebar)</p>
                    <button class="btn btn-sm btn-outline-primary" onclick="showApiGuide()">View Setup Guide</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Account -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üë§ User Account</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Username</label>
                    <input type="text" class="form-control" value="{{ user.username }}" disabled>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">WhatsApp Number</label>
                    <input type="text" class="form-control" value="{{ user.phone_number or 'Not set' }}" disabled>
                    <small class="text-muted">
                        <a href="{{ url_for('bots.profile') }}">Edit in Profile ‚Üí</a>
                    </small>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Account Created</label>
                    <input type="text" class="form-control" value="{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}" disabled>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">üîî Notifications</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="form_type" value="notifications">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="email_notifications" name="email_notifications" {% if email_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="email_notifications">
                            Email Notifications
                        </label>
                        <div class="form-text">Receive email alerts for bot activity (coming soon)</div>
                    </div>
                    <button type="submit" class="btn btn-warning">Save Notifications</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bot Statistics -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">üìä Quick Stats</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3 class="text-primary">{{ user.bots|length }}</h3>
                        <p class="text-muted mb-0">Active Bots</p>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">
                            {% set total_rules = namespace(count=0) %}
                            {% for bot in user.bots %}
                                {% set total_rules.count = total_rules.count + bot.rules|length %}
                            {% endfor %}
                            {{ total_rules.count }}
                        </h3>
                        <p class="text-muted mb-0">Total Rules</p>
                    </div>
                </div>
                <hr>
                <a href="{{ url_for('analytics.analytics') }}" class="btn btn-sm btn-outline-secondary w-100">View Full Analytics ‚Üí</a>
            </div>
        </div>
    </div>

    <!-- System Info -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">üñ•Ô∏è System Information</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>Session Security:</strong></td>
                        <td>
                            {% if env_status.session_secret %}
                                <span class="badge bg-success">Secure ‚úì</span>
                            {% else %}
                                <span class="badge bg-danger">Using Default</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Database:</strong></td>
                        <td><span class="badge bg-info">SQLite</span></td>
                    </tr>
                    <tr>
                        <td><strong>PWA Status:</strong></td>
                        <td><span class="badge bg-success">Enabled ‚úì</span></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
function showApiGuide() {
    window.location.href = "{{ url_for('bots.guide') }}";
}
</script>
{% endblock %}
